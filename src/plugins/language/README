This code was "stolen" from libkat 0.6.3 (GPLed).
libkat is part of kat (KDE project).
